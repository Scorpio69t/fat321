; 保护模式用到的常量和宏


; 用于创建段描述符的宏
; 用法: Descriptor Base, Limit, Attr
;        Base:  32位，段基址
;        Limit: 32位，段界限，低20位有效
;        Attr:  16位，其属性从高位到低位依次如下：
;		+---------------------------------------------------------------------------------------------------------+
;		| G(1位) |    D/B(1位)  |     L(1位)        |  AVL(1位)   |  P(1位)  |   DPL(2位)   |   S(1位)   | TYPE(4位) |
;		+---------------------------------------------------------------------------------------------------------+
;		| 粒度位  | 默认操作数大小 | 64位代码段（恒为0） |  供软件使用  |  段存在位  | 描述符特权级  | 描述符类型  | 描述符类型  |
;		+---------------------------------------------------------------------------------------------------------+
%macro Descriptor 3
	dw	%2 & 0FFFFh				; 段界限 1				(2 字节)
	dw	%1 & 0FFFFh				; 段基址 1				(2 字节)
	db	(%1 >> 16) & 0FFh			; 段基址 2				(1 字节)
	dw	((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)	; 属性 1 + 段界限 2 + 属性 2		 (2 字节)
	db	(%1 >> 24) & 0FFh			; 段基址 3				(1 字节)
%endmacro ; 共 8 字节


; 描述符类型值说明
; 其中:
;       DA_  : Descriptor Attribute
;       D    : 数据段
;       C    : 代码段
;       S    : 系统段
;       R    : 只读
;       RW   : 读写
;       A    : 已访问
;       其它 : 可按照字面意思理解
DA_32		equ	4000h	; 32 位段
DA_LIMIT_4K	equ	8000h	; 段界限粒度为 4K 字节

DA_DPL0		equ	  00h	; DPL = 0
DA_DPL1		equ	  20h	; DPL = 1
DA_DPL2		equ	  40h	; DPL = 2
DA_DPL3		equ	  60h	; DPL = 3


; 存储段描述符类型值说明
DA_DR		equ	90h	; 存在的只读数据段类型值
DA_DRW		equ	92h	; 存在的可读写数据段属性值
DA_DRWA		equ	93h	; 存在的已访问可读写数据段类型值
DA_C		equ	98h	; 存在的只执行代码段属性值
DA_CR		equ	9Ah	; 存在的可执行可读代码段属性值
DA_CCO		equ	9Ch	; 存在的只执行一致代码段属性值
DA_CCOR		equ	9Eh	; 存在的可执行可读一致代码段属性值

; 系统段描述符类型值说明
DA_LDT		equ	  82h	; 局部描述符表段类型值
DA_TaskGate	equ	  85h	; 任务门类型值
DA_386TSS	equ	  89h	; 可用 386 任务状态段类型值
DA_386CGate	equ	  8Ch	; 386 调用门类型值
DA_386IGate	equ	  8Eh	; 386 中断门类型值
DA_386TGate	equ	  8Fh	; 386 陷阱门类型值



; 选择子类型值说明
; 其中: SA_  : Selector Attribute
SA_RPL0		equ	0
SA_RPL1		equ	1
SA_RPL2		equ	2
SA_RPL3		equ	3

SA_TIG		equ	0
SA_TIL		equ	4


; 分页使用的一些常量
PG_P		equ	1	; 页存在属性位
PG_RWR		equ	0	; R/W 属性位值, 读/执行
PG_RWW		equ	2	; R/W 属性位值, 读/写/执行
PG_USS		equ	0	; U/S 属性位值, 系统级
PG_USU		equ	4	; U/S 属性位值, 用户级
