; 硬盘的MBR分区数据，包括引导代码和分区表

	org 7c00h
StackStart	equ	0x7c00
StartLBA	equ	8

	mov	ax, cs
	mov	ds, ax
	mov	es, ax
	mov	ss, ax
	mov	sp, StackStart

	mov	ah, 0x42	; 读硬盘
	mov	dl, 0x80	; 驱动器号
	mov	si, dbraddr
	int	0x13
	jc	error
	mov	ax, 0x0000
	mov	cx, SuccessMsg
	call	disp_str

	jmp	0x0000:0x8000
error:
	mov	ax, 0x0000
	mov	cx, ErrorMsg
	call	disp_str
	hlt

dbraddr:
	db 	0x10		; dbraddr结构体大小
	db 	0		; 保留
	dw 	1		; 读取一个扇区
	dw 	0x8000		; 保存读取内容的内存偏移地址
	dw 	0x0000		; 保存读取内容的内存段地址
	dd 	2048		; LBA扇区号
	dd 	0		; 用于大容量存储设备的读取

; 在屏幕上显示字符串
; 参数： ah=屏幕第几行 al=屏幕第几列 cx=字符串首地址
disp_str:
	pushad
	push 	es
	mov	dx, ax
	mov	ax, cs
	mov	es, ax
	mov	bp, cx
	mov	cx, BootMessageLen
	mov	bx, 0x0002		; 黑底绿字
	mov	ax, 0x1301
	int	10h
	pop	es
	popad
	ret

BootMessageLen equ	7
SuccessMsg:	db 'success'
ErrorMsg:	db 'faild  '

times	446 - ($ -$$) db 0
partition0:
	db 0x80, 0x66, 0x09, 0x00, 0x01, 0x13, 0x05, 0x0f
	db 0x00, 0x08, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00
partition1:
	db 0x00, 0x79, 0x0d, 0x0f, 0x0c, 0x19, 0x4d, 0xd4
	db 0x00, 0x10, 0x01, 0x00, 0x01, 0xf0, 0x1e, 0x00
partition2:
	db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
partition3:
	db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

dw	0xaa55
